<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kasRoulette</title>
	<link rel="icon" type="image/png" href="/favicon.png">
    <style>
        :root {
            --felt: #1e5a30;
            --gold: #f1c40f;
            --red: #c0392b;
            --black: #2c3e50;
            --border: #ecf0f1;
            --bg: #111;
            --neon-win: #2ecc71;
            --snake: #e74c3c;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            user-select: none;
        }

        /* --- LAYOUT --- */
        .main-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
            gap: 40px;
            width: 100%;
            max-width: 1400px;
            margin-top: 10px;
        }

        .wheel-section {
            flex: 0 0 350px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .board-section {
            flex: 1;
            min-width: 300px;
            max-width: 950px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- HEADER --- */
        header {
            display: flex;
            flex-direction: column;
            gap: 5px;
            align-items: center;
            width: 100%;
            max-width: 800px;
            margin-bottom: 15px;
        }

        .stats-row {
            display: flex;
            gap: 20px;
            background: #222;
            padding: 8px 30px;
            border-radius: 50px;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        
        .stat-box { display: flex; align-items: center; gap: 0px; font-size: 1rem; }
        .gold-text { color: var(--gold); font-weight: bold; }
        .high-score { border-left: 1px solid #555; padding-left: 15px; color: #aaa; font-size: 0.8rem; }

		/* MUTE BUTTON STYLES */
		.mute-btn {
			position: absolute; /* fix position relative to the page */
			top: 8px;          /* distance from top */
			right: 8px;        /* distance from right */
			z-index: 100;       /* ensure it stays on top of other elements */
			
			background: #333;
			border: 1px solid #555;
			color: #ccc;
			border-radius: 20px;
			padding: 5px 10px;  /* slightly larger hit area */
			font-size: 0.55rem;
			cursor: pointer;
			text-transform: uppercase;
			font-weight: bold;
			transition: all 0.2s;
			min-width: 60px;
			text-align: center;
			box-shadow: 0 2px 5px rgba(0,0,0,0.5); /* added shadow for visibility */
		}
		.mute-btn:hover { background: #444; color: white; }
		.mute-btn.muted { background: var(--red); color: white; border-color: var(--red); }

        .history-bar {
            display: flex;
            gap: 3px;
            height: 24px;
            align-items: center;
            opacity: 0.8;
            margin-top: 5px;
        }
        .history-dot {
            width: 18px; height: 18px;
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 9px; font-weight: bold;
            border: 1px solid #444;
            box-shadow: 0 1px 3px rgba(0,0,0,0.5);
            cursor: default;
        }
        .dot-red { background: var(--red); color: white; }
        .dot-black { background: var(--black); color: white; }
        .dot-green { background: var(--felt); color: var(--gold); border: 1px solid var(--gold); }
        .history-label { font-size: 0.7rem; color: #555; margin-right: 5px; text-transform: uppercase; letter-spacing: 1px; }

        /* --- WHEEL SVG --- */
        .wheel-svg-container {
            width: 380px;
            height: 380px;
            position: relative;
            filter: drop-shadow(0 0 20px rgba(0,0,0,0.8));
        }
        
        #wheelGroup {
            transition: transform 8s cubic-bezier(0.1, 0.8, 0.1, 1);
            transform-origin: center;
        }

        .wheel-rim { fill: #444; stroke: var(--gold); stroke-width: 8; }
        .wheel-center { fill: var(--gold); }
        .wedge { stroke: #fff; stroke-width: 0.5px; }
        .wedge-label { 
            fill: white; font-size: 10px; font-weight: bold; 
            text-anchor: middle; dominant-baseline: middle;
        }
        .ball-marker { fill: white; filter: drop-shadow(0 0 5px white); }
        .marker-contain { pointer-events: none; }

        /* --- BOARD SVG --- */
        .table-container {
            width: 100%;
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
            margin-bottom: 20px;
        }

        svg.board-svg {
            width: 100%;
            height: auto;
            cursor: pointer;
        }

        .zone { stroke: var(--border); stroke-width: 1px; transition: opacity 0.1s; }
        .zone:hover { opacity: 0.8; }
        .zone-red { fill: var(--red); }
        .zone-black { fill: var(--black); }
        .zone-green { fill: var(--felt); stroke: var(--border); }
        
        .zone-label { 
            fill: white; font-weight: bold; font-size: 16px; 
            pointer-events: none; text-anchor: middle; dominant-baseline: middle;
        }
        .label-rotated { transform-box: fill-box; transform-origin: center; transform: rotate(-90deg); }

        @keyframes pulse {
            0% { fill: var(--neon-win); opacity: 1; }
            50% { fill: white; opacity: 1; }
            100% { fill: var(--neon-win); opacity: 1; }
        }
        .winner-anim {
            animation: pulse 0.8s infinite;
            stroke: var(--gold) !important;
            stroke-width: 3px !important;
            z-index: 10;
        }

        /* --- HITBOX VISUALIZATION --- */
        .hitbox { fill: transparent; stroke: none; transition: fill 0.1s; cursor: pointer; }
        .hitbox:hover { fill: rgba(241, 196, 15, 0.4); }

        /* Chips */
        #chipLayer { pointer-events: none; }
        .chip-body { fill: white; stroke: var(--gold); stroke-width: 3px; stroke-dasharray: 4 2; }
        .chip-text { font-size: 11px; font-weight: bold; fill: black; text-anchor: middle; dominant-baseline: middle; }
        .chip-shadow { fill: rgba(0,0,0,0.5); }

        /* --- CONTROLS --- */
        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            background: #1a1a1a;
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #333;
        }

        .controls-row {
            display: flex;
            gap: 8px;
            justify-content: center;
            width: 100%;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 20px; font-size: 0.95rem; border: none; border-radius: 5px;
            cursor: pointer; font-weight: bold; text-transform: uppercase;
            box-shadow: 0 4px 0 #000; transition: transform 0.1s;
            min-width: 90px;
            flex: 1;
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .btn:disabled { background: #333; color: #666; cursor: not-allowed; box-shadow: none; }
        
        .btn-spin { background: var(--gold); color: #111; flex-grow: 2; font-size: 1.2rem; max-width: 100%; }
        .btn-clear { background: #c0392b; color: white; }
        .btn-rebet { background: #3498db; color: white; }
        .btn-special { background: #8e44ad; color: white; }
        
        .special-menu {
            display: none;
            gap: 8px; /* Slightly tighter gap for grid */
            width: 100%;
            background: #222;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #444;
        }
        
        .special-menu.active { 
            display: grid; 
            grid-template-columns: repeat(5, 1fr); /* Forces 5 equal columns */
        }

        .msg-display {
            min-height: 25px; margin-bottom: 10px; 
            color: var(--gold); font-size: 1.2rem; font-weight: bold;
            text-align: center; text-shadow: 0 2px 4px black;
        }

        .instruction-text {
            color: #666; margin-top: 5px; font-size: 0.8rem;
            text-align: center; line-height: 1.4;
        }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none; justify-content: center; align-items: center; z-index: 100;
        }
        .modal {
            background: #222; border: 2px solid var(--gold); padding: 30px;
            text-align: center; border-radius: 10px; box-shadow: 0 0 30px var(--gold);
        }
		
		/* --- CHIP SELECTOR --- */
        .chip-bar {
            display: flex;
            justify-content: center;
            gap: 36px;
            background: #1e5a30; /* Match felt color */
            width: 100%;
            padding: 10px 0 20px 54px; /* Added 40px left padding */
            box-sizing: border-box;    /* Ensures padding doesn't expand the width */
            border-bottom-left-radius: 15px;
            border-bottom-right-radius: 15px;
            margin-top: -60px; /* Pull up to overlap SVG bottom */
            position: relative;
            z-index: 5;
            box-shadow: 0 10px 10px -5px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }

        .chip {
            width: 36px; height: 36px;
            border-radius: 50%;
            border: 4px dashed white;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; font-size: 12px; color: white;
            cursor: pointer; text-shadow: 1px 1px 2px black;
            box-shadow: 0 3px 5px rgba(0,0,0,0.5);
            transition: transform 0.1s, box-shadow 0.1s;
            user-select: none;
        }

        .chip:hover { transform: translateY(-3px); }
        .chip:active { transform: scale(0.95); }
        
        /* Active State (Selected) */
        .chip.active { 
            border-style: solid; 
            box-shadow: 0 0 15px var(--gold), inset 0 0 10px rgba(0,0,0,0.5); 
            transform: scale(1.15);
            z-index: 10;
        }

        /* Denomination Colors */
        .chip-10 { background: #e74c3c; border-color: white; }
        .chip-20 { background: #828282; border-color: white; }
        .chip-50 { background: #e89149; border-color: white; }
        .chip-100 { background: #151922; border-color: white; }
    </style>
</head>
<body>
    <button class="mute-btn" id="btnMute" onclick="toggleMute()">Audio ON</button>

    <header>
        <div class="stats-row">
            <div class="stat-box">Balance: $<span id="balanceDisplay" class="gold-text">500</span></div>
            <div class="stat-box">Bet: $<span id="betDisplay">0</span></div>
            <div class="stat-box high-score">Best: $<span id="highScoreDisplay">500</span></div>
        </div>
        <div class="history-bar" id="historyContainer">
            <span class="history-label">History</span>
        </div>
    </header>

    <div class="main-container">
        
        <div class="wheel-section">
            <div class="wheel-svg-container">
                <svg viewBox="0 0 400 400">
                    <circle cx="200" cy="200" r="195" class="wheel-rim" />
                    <g id="wheelGroup"></g>
                    <circle cx="200" cy="200" r="20" class="wheel-center" />
                    <circle cx="200" cy="200" r="150" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1" />
                    
                    <g class="marker-contain">
                        <circle cx="200" cy="35" r="7" fill="rgba(0,0,0,0.5)" />
                        <circle cx="200" cy="32" r="7" class="ball-marker" />
                        <path d="M 200 45 L 194 55 L 206 55 Z" fill="var(--gold)" />
                    </g>
                </svg>
            </div>
        </div>

        <div class="board-section">
            
            <div class="table-container" style="margin-bottom: 0;"> <svg id="boardSvg" class="board-svg" viewBox="0 0 920 350">
                    <rect x="0" y="0" width="920" height="350" fill="#1e5a30" rx="15" ry="15" oncontextmenu="return false;" />
                    
                    <g transform="translate(26, 0)">
                        <g id="gridLayer"></g>
                        <g id="hitboxLayer"></g>
                        <g id="textLayer"></g>
                        <g id="chipLayer" style="pointer-events: none;"></g>
                    </g>
                </svg>
            </div>

            <div class="chip-bar">
                <div class="chip chip-10 active" onclick="selectChip(10)">10</div>
                <div class="chip chip-20" onclick="selectChip(20)">20</div>
                <div class="chip chip-50" onclick="selectChip(50)">50</div>
                <div class="chip chip-100" onclick="selectChip(100)">100</div>
            </div>

            <div class="controls">
                <div class="msg-display" id="msg">Place your bets</div>
                
                <div id="specialMenu" class="special-menu">
                    <button class="btn btn-special btn-sm" onclick="placePattern('snake')">Red Snake</button>
                    <button class="btn btn-special btn-sm" onclick="placePattern('007')">007</button>
                    <button class="btn btn-special btn-sm" onclick="placePattern('romanosky')">Romanosky</button>
                    <button class="btn btn-special btn-sm" onclick="placePattern('shotwell_std')">Shotwell Std</button>
                    <button class="btn btn-special btn-sm" onclick="placePattern('shotwell_high')">Shotwell High</button>
                    <button class="btn btn-special btn-sm" onclick="placePattern('double_st_quad')">Dbl St. Quad</button>
                    <button class="btn btn-special btn-sm" onclick="placePattern('five_quad')">Five Quad</button>
                    <button class="btn btn-special btn-sm" onclick="placePattern('3_2_red')">3/2 Red</button>
                    <button class="btn btn-special btn-sm" onclick="placePattern('kavouras')">Kavouras</button>
                    <button class="btn btn-special btn-sm" onclick="placePattern('666')">666 Strat</button>
                </div>

                <div class="controls-row">
                    <button class="btn btn-clear" onclick="clearBets()" id="btnClear">Clear</button>
                    <button class="btn btn-rebet" onclick="rebet()" id="btnRebet">Rebet</button>
                    <button class="btn btn-rebet" onclick="doubleBet()" id="btnDouble">x2</button>
                    <button class="btn btn-special" onclick="toggleSpecial()" id="btnSpecial">Pro Bets</button>
                </div>
                <div class="controls-row">
                    <button class="btn btn-spin" onclick="spin()" id="spinBtn">SPIN</button>
                </div>

                <div class="instruction-text">
                    L-Click: Bet $10 &bull; R-Click: Remove $10
                </div>
            </div>

        </div>
    </div>

    <div class="modal-overlay" id="gameOverModal">
        <div class="modal">
            <h2>BANKRUPT!</h2>
            <p>The house always wins... eventually.</p>
            <button class="btn btn-rebet" onclick="restartGame()">Restart with $500</button>
        </div>
    </div>

    <script>
        // --- CONSTANTS ---
        const WHEEL_ORDER = [0, 28, 9, 26, 30, 11, 7, 20, 32, 17, 5, 22, 34, 15, 3, 24, 36, 13, 1, '00', 27, 10, 25, 29, 12, 8, 19, 31, 18, 6, 21, 33, 16, 4, 23, 35, 14, 2];
        const REDS = [1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36];
        const SNAKE_NUMS = [1, 5, 9, 12, 14, 16, 19, 23, 27, 30, 32, 34, 36]; // Corrected snake numbers
        
        const CELL_W = 60;
        const CELL_H = 50;
        const GRID_X = 100;
        const GRID_Y = 20;
        const SPIN_DURATION_MS = 6000; 
        const MAX_HISTORY = 15;

        // --- AUDIO IMPLEMENTATION ---
		// Check localStorage; default to false (not muted) if nothing is saved
		let isMuted = localStorage.getItem('rouletteMuteState') === 'true';
        let isMuted = false;

        // Ensure these files exist in the same directory, or the browser will show 404s
        const sounds = {
            click: new Audio('click.mp3'),
            spin: new Audio('spin.mp3'),
            win: new Audio('win.mp3'),
            lose: new Audio('lose.mp3')
        };

        // Configuration
        sounds.click.volume = 0.4;
        sounds.spin.volume = 0.5;
        sounds.spin.loop = false; // Spin sound loops while wheel turns
        sounds.win.volume = 0.6;
        sounds.lose.volume = 0.5;

        function toggleMute() {
			isMuted = !isMuted;
			
			// Save to Local Storage
			localStorage.setItem('rouletteMuteState', isMuted);

			const btn = document.getElementById('btnMute');
			
			if(isMuted) {
				btn.innerText = "MUTED";
				btn.classList.add('muted');
				// Immediately silence any playing audio
				Object.values(sounds).forEach(s => s.pause());
			} else {
				btn.innerText = "Audio ON";
				btn.classList.remove('muted');
			}
		}

        function playSound(name) {
            if(isMuted) return;
            
            const s = sounds[name];
            if(s) {
                // For non-looping sounds, reset time to allow rapid re-play
                if(!s.loop) {
                    s.currentTime = 0;
                }
                // Play and catch errors (e.g., user hasn't interacted with page yet)
                s.play().catch(e => console.warn(`Audio '${name}' blocked or missing.`, e));
            }
        }

        // --- STATE ---
		let currentChipValue = 10;
        let balance = 500;
        let bets = {};
        let lastBets = {}; 
        let zoneCenters = {}; 
        let isSpinning = false;
        let currentWheelRotation = 0;
        let history = [];
        let highScore = localStorage.getItem('rouletteProMaxHighScore') || 500;
		

        window.onload = () => {
			// Load High Score
			document.getElementById('highScoreDisplay').innerText = highScore;
			
			// Load Mute State Visuals
			if (isMuted) {
				const btn = document.getElementById('btnMute');
				btn.innerText = "MUTED";
				btn.classList.add('muted');
			}

			drawWheel();
			drawBoard();
			document.getElementById('boardSvg').addEventListener('contextmenu', event => event.preventDefault());
		};

        // --- RENDER FUNCTIONS ---
        function drawWheel() {
            const group = document.getElementById('wheelGroup');
            const radius = 190;
            const cx = 200, cy = 200;
            const sliceDeg = 360 / WHEEL_ORDER.length;

            WHEEL_ORDER.forEach((val, i) => {
                const startAngle = (i * sliceDeg) - 90 - (sliceDeg/2);
                const endAngle = startAngle + sliceDeg;
                const x1 = cx + radius * Math.cos(Math.PI * startAngle / 180);
                const y1 = cy + radius * Math.sin(Math.PI * startAngle / 180);
                const x2 = cx + radius * Math.cos(Math.PI * endAngle / 180);
                const y2 = cy + radius * Math.sin(Math.PI * endAngle / 180);

                const d = `M ${cx} ${cy} L ${x1} ${y1} A ${radius} ${radius} 0 0 1 ${x2} ${y2} Z`;
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute("d", d);
                path.setAttribute("class", "wedge");
                
                if (val === 0 || val === '00') path.setAttribute("fill", "#1e5a30");
                else if (REDS.includes(val)) path.setAttribute("fill", "#c0392b");
                else path.setAttribute("fill", "#2c3e50");
                group.appendChild(path);

                const textAngle = (i * sliceDeg) - 90;
                const tx = cx + (radius * 0.85) * Math.cos(Math.PI * textAngle / 180);
                const ty = cy + (radius * 0.85) * Math.sin(Math.PI * textAngle / 180);
                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", tx); text.setAttribute("y", ty);
                text.setAttribute("class", "wedge-label");
                text.setAttribute("transform", `rotate(${textAngle + 90}, ${tx}, ${ty})`);
                text.textContent = val;
                group.appendChild(text);
            });
        }

        function drawRect(id, x, y, w, h, color, labelText, rotate = false) {
            const grid = document.getElementById('gridLayer');
            const textL = document.getElementById('textLayer');
            const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            rect.setAttribute("id", "zone_"+id);
            rect.setAttribute("x", x); rect.setAttribute("y", y);
            rect.setAttribute("width", w); rect.setAttribute("height", h);
            rect.setAttribute("class", `zone ${color}`);
            rect.onclick = () => placeBet(id);
            rect.oncontextmenu = (e) => { e.preventDefault(); removeBet(id); };
            grid.appendChild(rect);

            if (labelText) {
                const txt = document.createElementNS("http://www.w3.org/2000/svg", "text");
                txt.setAttribute("x", x + w/2);
                txt.setAttribute("y", y + h/2 + 1);
                txt.setAttribute("class", `zone-label ${rotate ? 'label-rotated' : ''}`);
                txt.textContent = labelText;
                textL.appendChild(txt);
            }
            zoneCenters[id] = { x: x + w/2, y: y + h/2 };
        }

        function drawHitbox(id, x, y, w, h, label) {
            const layer = document.getElementById('hitboxLayer');
            const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            rect.setAttribute("x", x); rect.setAttribute("y", y);
            rect.setAttribute("width", w); rect.setAttribute("height", h);
            rect.setAttribute("class", "hitbox");
            const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
            title.textContent = label;
            rect.appendChild(title);
            rect.onclick = () => placeBet(id);
            rect.oncontextmenu = (e) => { e.preventDefault(); removeBet(id); };
            layer.appendChild(rect);
            zoneCenters[id] = { x: x + w/2, y: y + h/2 };
        }

		function drawBoard() {
            const zeroH = (CELL_H * 3) / 2;
            
            // 00 and 0 Backgrounds
            draw00And0(zeroH);

            // Numbers 1-36 Backgrounds
            for(let i=1; i<=36; i++){
                let r = (i%3===0)?0 : (i%3===2)?1 : 2;
                let c = Math.ceil(i/3)-1;
                let color = REDS.includes(i) ? 'zone-red' : 'zone-black';
                drawRect(i.toString(), GRID_X + c*CELL_W, GRID_Y + r*CELL_H, CELL_W, CELL_H, color, i);
            }

            const HIT_SIZE = 16; 
            
            // --- 1. VERTICAL SPLITS (Side-by-Side numbers) ---
            for (let c = 0; c < 11; c++) {
                const x = GRID_X + (c + 1) * CELL_W - (HIT_SIZE / 2);
                for (let r = 0; r < 3; r++) {
                    const y = GRID_Y + r * CELL_H + 5;
                    const valLeft = (c * 3) + (3-r);
                    const valRight = ((c + 1) * 3) + (3-r);
                    drawHitbox(`split_${valLeft}_${valRight}`, x, y, HIT_SIZE, CELL_H - 10, `Split ${valLeft}-${valRight}`);
                }
            }

            // --- 2. HORIZONTAL SPLITS (Stacked numbers) ---
            for (let c = 0; c < 12; c++) {
                const x = GRID_X + c * CELL_W + 5;
                for (let r = 0; r < 2; r++) {
                    const y = GRID_Y + (r + 1) * CELL_H - (HIT_SIZE / 2);
                    const valBot = (c * 3) + (3 - (r+1)); 
                    const valTop = valBot + 1;
                    drawHitbox(`split_${valBot}_${valTop}`, x, y, CELL_W - 10, HIT_SIZE, `Split ${valBot}-${valTop}`);
                }
            }

            // --- 3. CORNERS (Quad bets) ---
            for (let c = 0; c < 11; c++) {
                const x = GRID_X + (c + 1) * CELL_W - (HIT_SIZE / 2);
                for (let r = 0; r < 2; r++) {
                    const y = GRID_Y + (r + 1) * CELL_H - (HIT_SIZE / 2);
                    const tl = (c * 3) + (2 - r);
                    drawHitbox(`corner_${tl}`, x, y, HIT_SIZE, HIT_SIZE, `Corner`);
                }
            }

            // --- 4. STREETS (Top and Bottom edges) ---
            for (let c = 0; c < 12; c++) {
                const x = GRID_X + c * CELL_W;
                const startNum = (c * 3) + 1; 
                
                // Top Street (Rows 3, 6, 9...)
                drawHitbox(`street_${startNum}`, x, GRID_Y - 15, CELL_W, 15, `Street ${startNum}-${startNum+2}`);
                
                // Bottom Street (Rows 1, 4, 7...) - NEW
                // Positions at the bottom of the grid, slightly overlapping the outside bets
                drawHitbox(`street_${startNum}`, x, GRID_Y + (CELL_H * 3), CELL_W, 15, `Street ${startNum}-${startNum+2}`);
            }

            // --- 5. SIX LINES (Top and Bottom intersections) ---
            for (let c = 0; c < 11; c++) {
                const x = GRID_X + (c+1) * CELL_W - 10;
                const startNum = (c * 3) + 1;

                // Top Six Line
                drawHitbox(`sixline_${startNum}`, x, GRID_Y - 15, 20, 15, `Six Line`);

                // Bottom Six Line - NEW
                drawHitbox(`sixline_${startNum}`, x, GRID_Y + (CELL_H * 3), 20, 15, `Six Line`);
            }

            // --- 6. ZERO COMPLEX (Precise Layout) ---
            
            // Vertical Splits: 0/1, 00/3, 0/2, 00/2
            drawHitbox('split_0_1', GRID_X - 10, GRID_Y + (CELL_H*2)+5, 20, CELL_H-10, "Split 0-1");
            drawHitbox('split_0_2', GRID_X - 10, GRID_Y + CELL_H + (CELL_H/2), 20, CELL_H/2, "Split 0-2");
            drawHitbox('split_00_2', GRID_X - 10, GRID_Y + CELL_H, 20, CELL_H/2, "Split 00-2");
            drawHitbox('split_00_3', GRID_X - 10, GRID_Y+5, 20, CELL_H-10, "Split 00-3");

            // Basket / Trios
            drawHitbox('trio_0_1_2', GRID_X - 10, GRID_Y + (CELL_H*2) - 10, 20, 20, "Basket 0-1-2");
            drawHitbox('trio_00_2_3', GRID_X - 10, GRID_Y + CELL_H - 10, 20, 20, "Basket 00-2-3");
            
            // 0-00 Split
            drawHitbox('split_0_00', 20, GRID_Y + zeroH - 10, GRID_X-20, 20, "Split 0-00");

            // THE MONSTER: Top Line (0, 00, 1, 2, 3)
            // Bottom Corner (Intersection 0/1)
            drawHitbox('topline', GRID_X - 10, GRID_Y + (CELL_H*3) - 15, 20, 30, "Top Line (0,00,1,2,3)");
            
            // Top Corner (Intersection 00/3) - NEW
            // Placed at the top-left corner intersection
            drawHitbox('topline', GRID_X - 10, GRID_Y - 15, 20, 30, "Top Line (0,00,1,2,3)");

            drawOutsideBets();
        }

        function draw00And0(zeroH) {
            // 00 (Top Half)
            const p00 = document.createElementNS("http://www.w3.org/2000/svg", "path");
            p00.setAttribute("id", "zone_00");
            p00.setAttribute("d", `M 20 ${GRID_Y} L ${GRID_X} ${GRID_Y} L ${GRID_X} ${GRID_Y + zeroH} L 20 ${GRID_Y + zeroH} L 0 ${GRID_Y + zeroH/2} Z`);
            p00.setAttribute("class", "zone zone-green");
            p00.onclick = () => placeBet('00');
            document.getElementById('gridLayer').appendChild(p00);
            
            const t00 = document.createElementNS("http://www.w3.org/2000/svg", "text");
            t00.setAttribute("x", 45); t00.setAttribute("y", GRID_Y + zeroH/2);
            t00.setAttribute("class", "zone-label"); t00.textContent = "00";
            document.getElementById('textLayer').appendChild(t00);
            zoneCenters['00'] = {x:45, y:GRID_Y + zeroH/2};

            // 0 (Bottom Half)
            const y0 = GRID_Y + zeroH;
            const p0 = document.createElementNS("http://www.w3.org/2000/svg", "path");
            p0.setAttribute("id", "zone_0");
            p0.setAttribute("d", `M 20 ${y0} L ${GRID_X} ${y0} L ${GRID_X} ${y0 + zeroH} L 20 ${y0 + zeroH} L 0 ${y0 + zeroH/2} Z`);
            p0.setAttribute("class", "zone zone-green");
            p0.onclick = () => placeBet('0');
            document.getElementById('gridLayer').appendChild(p0);

            const t0 = document.createElementNS("http://www.w3.org/2000/svg", "text");
            t0.setAttribute("x", 45); t0.setAttribute("y", y0 + zeroH/2);
            t0.setAttribute("class", "zone-label"); t0.textContent = "0";
            document.getElementById('textLayer').appendChild(t0);
            zoneCenters['0'] = {x:45, y:y0 + zeroH/2};
        }

        function drawOutsideBets() {
            const endX = GRID_X + 12*CELL_W;
            // Columns
            drawRect('c3', endX, GRID_Y, 40, CELL_H, 'zone-green', '2:1', true);
            drawRect('c2', endX, GRID_Y+CELL_H, 40, CELL_H, 'zone-green', '2:1', true);
            drawRect('c1', endX, GRID_Y+CELL_H*2, 40, CELL_H, 'zone-green', '2:1', true);

            // Dozens
            const botY = GRID_Y + 3*CELL_H;
            const dozW = 4*CELL_W;
            drawRect('dozen1', GRID_X, botY, dozW, CELL_H, 'zone-green', '1st 12');
            drawRect('dozen2', GRID_X+dozW, botY, dozW, CELL_H, 'zone-green', '2nd 12');
            drawRect('dozen3', GRID_X+dozW*2, botY, dozW, CELL_H, 'zone-green', '3rd 12');

            // 50/50s
            const botY2 = botY + CELL_H;
            const simW = 2*CELL_W;
            drawRect('low', GRID_X, botY2, simW, CELL_H, 'zone-green', '1-18');
            drawRect('even', GRID_X+simW, botY2, simW, CELL_H, 'zone-green', 'EVEN');
            drawRect('red', GRID_X+simW*2, botY2, simW, CELL_H, 'zone-red', 'RED');
            drawRect('black', GRID_X+simW*3, botY2, simW, CELL_H, 'zone-black', 'BLK');
            drawRect('odd', GRID_X+simW*4, botY2, simW, CELL_H, 'zone-green', 'ODD');
            drawRect('high', GRID_X+simW*5, botY2, simW, CELL_H, 'zone-green', '19-36');
        }

        // --- LOGIC ---
		function selectChip(val) {
            currentChipValue = val;
            playSound('click'); // Click sound
            
            // Visual Update
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            document.querySelector(`.chip-${val}`).classList.add('active');
            
            // Update Instructions
            const instr = document.querySelector('.instruction-text');
            if(instr) instr.innerHTML = `L-Click: Bet $${val} &bull; R-Click: Remove $${val}`;
        }

        function placeBet(id, amount = null) {
            if(isSpinning) return;
            
            // Use provided amount (for Patterns) or selected chip value (for manual clicks)
            const val = amount !== null ? amount : currentChipValue;

            const currentTotal = Object.values(bets).reduce((a,b)=>a+b,0);
            if (currentTotal + val > balance) return showMsg("Insufficient funds!", '#ff6b6b');

            if(!bets[id]) bets[id]=0;
            bets[id] += val;
            updateUI();
            
            // Sound trigger
            if(amount === null) playSound('click');

            // Only show message if manual click (amount is null) to avoid spamming msg on patterns
            if(amount === null) showMsg(`Bet $${val} on ${id}`); 
            else showMsg("Bet Placed");
        }

        function toggleSpecial() {
            playSound('click');
            const m = document.getElementById('specialMenu');
            m.classList.toggle('active');
        }
		function placePattern(type) {
            if(isSpinning) return;
            playSound('click'); // Single click for pattern placement
            
            if(type === 'snake') {
                // Red Snake: $10 each on specific red numbers
                SNAKE_NUMS.forEach(n => placeBet(n.toString(), 10));
                showMsg("Red Snake Placed ($120)");
            }
            else if(type === '007') {
                // 007: High ($140), Six-Line 13-18 ($50), Split 0/00 ($10)
                placeBet('high', 140);
                placeBet('sixline_13', 50);
                placeBet('split_0_00', 10);
                showMsg("007 Strategy Placed ($200)");
            }
            else if(type === 'romanosky') {
                // Romanosky: Corners $10, Dozens $30 (Matches 1 unit / 3 units ratio)
                placeBet('corner_2', 10);
                placeBet('corner_7', 10);
                placeBet('dozen2', 30);
                placeBet('dozen3', 30);
                showMsg("Romanosky Placed ($80)");
            }
            else if(type === 'shotwell_std') {
                // Shotwell Std: Six-Line $10, Straights $10
                placeBet('sixline_1', 10);
                ['8', '10', '20', '26'].forEach(n => placeBet(n, 10));
                showMsg("Shotwell Std Placed ($50)");
            }
            else if(type === 'shotwell_high') {
                // Shotwell High: Six-Line $10, Straights $10
                placeBet('sixline_31', 10);
                ['0', '00', '29', '30'].forEach(n => placeBet(n, 10));
                showMsg("Shotwell High Placed ($50)");
            }
            else if(type === 'double_st_quad') {
                // Dbl St. Quad: Six-Lines $10, Corner $10, Straight $10
                placeBet('sixline_13', 10);
                placeBet('sixline_19', 10);
                placeBet('corner_4', 10); 
                placeBet('0', 10);
                showMsg("Double St. Quad Placed ($40)");
            }
            else if(type === 'five_quad') {
                // Five Quad: Corners $10 each, Straight $10
                placeBet('corner_5', 10);  
                placeBet('corner_10', 10); 
                placeBet('corner_17', 10); 
                placeBet('corner_23', 10); 
                placeBet('corner_32', 10); 
                placeBet('00', 10);
                showMsg("Five Quad Placed ($60)");
            }
            else if(type === '3_2_red') {
                // 3/2 Red: Scaled to multiples of 10 (Ratio 3:2 -> $30 : $20)
                placeBet('red', 30);
                placeBet('c2', 20);
                showMsg("3/2 Red Placed ($50)");
            }
            else if(type === 'kavouras') {
                // Kavouras: All units scaled to $10
                placeBet('topline', 10); // Originally Corner 0-3
                placeBet('split_8_11', 10);
                placeBet('split_13_14', 10);
                placeBet('split_15_18', 10);
                placeBet('split_17_20', 10);
                placeBet('split_27_30', 10);
                placeBet('corner_32', 10);
                showMsg("Kavouras Placed ($70)");
            }
            else if(type === '666') {
                // 666 Strat: Scaled for $10 divisibility and break-even logic
                // Red $90 (Wins $90, covers losses)
                // Splits $10 (Pays $170, covers losses)
                // Straights $10 (Pays $350, big win)
                placeBet('red', 90);
                
                ['split_0_00', 'split_8_11', 'split_10_13', 'split_17_20', 'split_26_29', 'split_28_31']
                    .forEach(id => placeBet(id, 10));
                
                ['4', '6', '15'].forEach(n => placeBet(n, 10));
                
                showMsg("666 Strategy Placed ($180)");
            }
        }
		
        function removeBet(id) {
            if(isSpinning) return;
            if(bets[id] && bets[id] > 0) {
                playSound('click'); // Click on removal
                // Remove the currently selected chip value
                bets[id] -= currentChipValue;
                if(bets[id] <= 0) delete bets[id];
                updateUI();
            }
        }

        function clearBets() {
            if(isSpinning) return;
            playSound('click');
            bets = {};
            updateUI();
            showMsg("Bets cleared.");
        }

        function rebet() {
            if(isSpinning) return;
            playSound('click');
            const cost = Object.values(lastBets).reduce((a,b)=>a+b,0);
            if(cost > balance) return showMsg("Insufficient funds", '#ff6b6b');
            bets = JSON.parse(JSON.stringify(lastBets));
            updateUI();
        }

        function doubleBet() {
            if(isSpinning) return;
            playSound('click');
            const cost = Object.values(bets).reduce((a,b)=>a+b,0);
            if(cost > balance) return showMsg("Insufficient funds", '#ff6b6b');
            for(let k in bets) bets[k] *= 2;
            updateUI();
        }

        function showMsg(text, color='var(--gold)') {
            const msg = document.getElementById('msg');
            msg.innerText = text;
            msg.style.color = color;
            if(color !== 'var(--gold)') setTimeout(() => msg.style.color = 'var(--gold)', 1500);
        }

        function updateUI() {
            document.getElementById('balanceDisplay').innerText = balance;
            const total = Object.values(bets).reduce((a,b)=>a+b,0);
            document.getElementById('betDisplay').innerText = total;

            const layer = document.getElementById('chipLayer');
            layer.innerHTML = '';
            
            // Draw chips
            for(const [id, amt] of Object.entries(bets)) {
                if(amt <= 0) continue;
                
                // Safety check for complex keys not in zoneCenters
                if(!zoneCenters[id]) continue; 

                const c = zoneCenters[id];
                const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
                
                const sh = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                sh.setAttribute("cx", c.x+2); sh.setAttribute("cy", c.y+2);
                sh.setAttribute("r", 11); sh.setAttribute("class", "chip-shadow");
                g.appendChild(sh);

                const circ = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circ.setAttribute("cx", c.x); circ.setAttribute("cy", c.y);
                circ.setAttribute("r", 11); circ.setAttribute("class", "chip-body");
                g.appendChild(circ);

                const txt = document.createElementNS("http://www.w3.org/2000/svg", "text");
                txt.setAttribute("x", c.x); txt.setAttribute("y", c.y+1);
                txt.setAttribute("class", "chip-text");
                txt.textContent = amt >= 1000 ? (amt/1000).toFixed(1)+'k' : amt;
                g.appendChild(txt);
                
                layer.appendChild(g);
            }
        }

        function spin() {
            if(isSpinning) return;
            const totalBet = Object.values(bets).reduce((a,b)=>a+b,0);
            if(totalBet === 0) return showMsg("Please place a bet!");
            
            // --- Spin Audio Start ---
            // Reset to 0 so it always starts fresh, and play
            sounds.spin.currentTime = 0;
            playSound('spin');
            
            balance -= totalBet;
            lastBets = JSON.parse(JSON.stringify(bets));
            isSpinning = true;
            updateUI();
            showMsg("No more bets...");
            
            // Spin Animation
            const rIdx = Math.floor(Math.random() * WHEEL_ORDER.length);
            const resultVal = WHEEL_ORDER[rIdx];

            const wedgeSize = 360 / WHEEL_ORDER.length;
            const destinationAngle = -1 * (rIdx * wedgeSize);
            const currentAbs = currentWheelRotation; 
            const rounds = 5 + Math.random()*3; 
            let target = currentAbs + (360 * rounds);
            const remainder = target % 360;
            const destRem = (destinationAngle + 360000) % 360; 
            let diff = destRem - remainder;
            if(diff < 0) diff += 360;
            const finalRotate = target + diff;
            currentWheelRotation = finalRotate;
            
            document.getElementById('wheelGroup').style.transform = `rotate(${finalRotate}deg)`;

            setTimeout(() => {
                resolveBet(resultVal);
            }, SPIN_DURATION_MS);
        }

        function resolveBet(result) {
            isSpinning = false;
            
            // --- Stop Spin Audio ---
            sounds.spin.pause(); 
            sounds.spin.currentTime = 0;

            // History
            history.unshift(result);
            if(history.length > MAX_HISTORY) history.pop();
            const hCont = document.getElementById('historyContainer');
            hCont.innerHTML = '<span class="history-label">History</span>';
            history.forEach(val => {
                const d = document.createElement('div');
                d.className = 'history-dot';
                d.innerText = val;
                if(val===0||val==='00') d.classList.add('dot-green');
                else if(REDS.includes(val)) d.classList.add('dot-red');
                else d.classList.add('dot-black');
                hCont.appendChild(d);
            });

            // Calc Winnings
            let totalWin = 0;
            const num = (result === '00') ? -1 : parseInt(result);
            
            for(const [id, amt] of Object.entries(bets)) {
                let payout = 0;
                
                // Straight
                if(id === result.toString()) payout = 35;
                
                // Split (check ID format split_X_Y)
                else if(id.startsWith('split_')) {
                    const parts = id.split('_');
                    // split_0_1, split_0_00, split_10_13
                    const n1 = parts[1];
                    const n2 = parts[2];
                    if(n1 === result.toString() || n2 === result.toString()) payout = 17;
                }
                
                // Street (street_1 means 1,2,3)
                else if(id.startsWith('street_')) {
                    const s = parseInt(id.split('_')[1]);
                    if(num >= s && num <= s+2 && num !== -1 && result !== 0) payout = 11;
                }
                
                // Corner
                else if(id.startsWith('corner_')) {
                    const s = parseInt(id.split('_')[1]);
                    const grp = [s, s+1, s+3, s+4];
                    if(grp.includes(num)) payout = 8;
                }
                
                // Six Line
                else if(id.startsWith('sixline_')) {
                    const s = parseInt(id.split('_')[1]);
                    if(num >= s && num <= s+5 && num !== -1 && result !== 0) payout = 5;
                }
                
                // Trios / Basket
                else if(id === 'trio_0_1_2') {
                    if([0, 1, 2].includes(num)) payout = 11;
                }
                else if(id === 'trio_00_2_3') {
                    if(result === '00' || num === 2 || num === 3) payout = 11;
                }

                // Top Line
                else if(id === 'topline') {
                    // 0, 00, 1, 2, 3
                    if(result === '00' || (num >= 0 && num <= 3)) payout = 6;
                }
                
                // Outside
                else if(result !== 0 && result !== '00') {
                    if(id === 'red' && REDS.includes(num)) payout = 1;
                    if(id === 'black' && !REDS.includes(num)) payout = 1;
                    if(id === 'even' && num % 2 === 0) payout = 1;
                    if(id === 'odd' && num % 2 !== 0) payout = 1;
                    if(id === 'low' && num <= 18) payout = 1;
                    if(id === 'high' && num >= 19) payout = 1;
                    if(id === 'dozen1' && num <= 12) payout = 2;
                    if(id === 'dozen2' && num > 12 && num <= 24) payout = 2;
                    if(id === 'dozen3' && num > 24) payout = 2;
                    if(id === 'c1' && num % 3 === 1) payout = 2;
                    if(id === 'c2' && num % 3 === 2) payout = 2;
                    if(id === 'c3' && num % 3 === 0) payout = 2;
                }

                if(payout > 0) totalWin += amt + (amt * payout);
            }

            // Animate Winner
            document.querySelectorAll('.winner-anim').forEach(e=>e.classList.remove('winner-anim'));
            const wEl = document.getElementById('zone_'+result);
            if(wEl) wEl.classList.add('winner-anim');

            if(totalWin > 0) {
                balance += totalWin;
                playSound('win');
                showMsg(`Result: ${result} | WIN: $${totalWin}`, '#2ecc71');
            } else {
                playSound('lose');
                showMsg(`Result: ${result}`, '#ecf0f1');
            }
            
            bets = {};
            updateUI();
            
            if(balance > highScore) {
                highScore = balance;
                localStorage.setItem('rouletteProMaxHighScore', highScore);
                document.getElementById('highScoreDisplay').innerText = highScore;
            }
            
            if(balance <= 0) {
                setTimeout(() => document.getElementById('gameOverModal').style.display = 'flex', 2000);
            }
        }

        function restartGame() {
            playSound('click');
            balance = 500;
            document.getElementById('gameOverModal').style.display = 'none';
            showMsg("New Game Started");
            updateUI();
        }
    </script>
</body>
</html>
